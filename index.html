<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PlayFab Login Demo</title>
  <!-- Tailwind CSS (Play CDN for quick setup) -->
  <script src="https://cdn.tailwindcss.com?plugins=forms" defer></script>
  <!-- PlayFab JavaScript SDK -->
  <script src="https://download.playfab.com/PlayFabClientApi.js" defer></script>
  <style>
    /* เพิ่ม style โหลดฟอนต์ภาษาไทย (ถ้าต้องการ) */
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap');
    body { font-family: 'Sarabun', sans-serif; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <!-- Container กล่องฟอร์มล็อกอิน -->
  <div id="formContainer" class="bg-white p-6 rounded-lg shadow-md w-full max-w-sm">
    <h1 class="text-2xl font-semibold mb-5 text-center text-gray-800">เข้าสู่ระบบผู้เล่น</h1>
    <!-- ฟิลด์ Username -->
    <div class="mb-4">
      <label for="username" class="block mb-1 font-medium text-gray-700">ชื่อผู้ใช้ (Username)</label>
      <input type="text" id="username" name="username" required 
             class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:ring-blue-200 focus:border-blue-500" 
             placeholder="กรอกชื่อผู้ใช้" />
    </div>
    <!-- ฟิลด์ Password -->
    <div class="mb-6">
      <label for="password" class="block mb-1 font-medium text-gray-700">รหัสผ่าน (Password)</label>
      <input type="password" id="password" name="password" required 
             class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:ring-blue-200 focus:border-blue-500" 
             placeholder="กรอกรหัสผ่าน" />
    </div>
    <!-- ปุ่ม Login -->
    <button id="loginButton" type="button" 
            class="w-full bg-blue-600 text-white font-medium py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
      Login
    </button>
  </div>

  <!-- ส่วนแสดงข้อความต้อนรับหลังล็อกอินสำเร็จ (ซ่อนไว้ก่อน) -->
  <div id="messageContainer" class="hidden text-center">
    <h2 id="welcomeMessage" class="text-xl font-bold text-green-600 mt-8"></h2>
  </div>

  <!-- Script ส่วนการทำงานของ PlayFab Login -->
  <script>
    // ตั้งค่า Title ID ของเกม (ต้องแก้ไขเป็น TitleId จริงของคุณก่อนใช้งาน)
    var playFabTitleId = "2F5F0";
    PlayFab.settings.titleId = playFabTitleId;

    // ฟังก์ชันช่วยแสดงข้อความผิดพลาด (ถ้าต้องการ)
    function showError(message) {
      alert(message);
    }

    // เพิ่ม event ให้ปุ่ม Login เมื่อถูกคลิก
    document.getElementById('loginButton').addEventListener('click', function () {
      var username = document.getElementById('username').value;
      var password = document.getElementById('password').value;
      if (!username || !password) {
        showError("กรุณากรอกชื่อผู้ใช้และรหัสผ่าน");
        return;
      }
      // เรียกใช้ PlayFab API เพื่อ Login ด้วย Username/Password
      PlayFabClientSDK.LoginWithPlayFab({
        TitleId: playFabTitleId,
        Username: username,
        Password: password
      }, function(result, error) {
        if (result) {
          console.log("Login successful:", result);
          // ล็อกอินสำเร็จ -> เรียก AccountInfo เพื่อดึงชื่อผู้เล่น
          PlayFabClientSDK.GetAccountInfo({}, function(infoResult, infoError) {
            if (infoResult) {
              // ดึงข้อมูล AccountInfo (อาจอยู่ใน infoResult.data สำหรับ SDK เวอร์ชั่นใหม่)
              var accountInfo = infoResult.data ? infoResult.data.AccountInfo : infoResult.AccountInfo;
              // หาชื่อผู้เล่นที่จะใช้แสดง (DisplayName ถ้ามี, ถ้าไม่มีก็ใช้ Username)
              var playerName = "";
              if (accountInfo && accountInfo.TitleInfo && accountInfo.TitleInfo.DisplayName) {
                playerName = accountInfo.TitleInfo.DisplayName;
              } else if (accountInfo && accountInfo.Username) {
                playerName = accountInfo.Username;
              } else {
                playerName = username;
              }
              // แสดงข้อความต้อนรับพร้อมชื่อผู้เล่น
              document.getElementById('welcomeMessage').textContent = "ล็อกอินสำเร็จในชื่อผู้เล่น: " + playerName;
              // ซ่อนฟอร์มล็อกอิน และแสดงข้อความสำเร็จ
              document.getElementById('formContainer').classList.add('hidden');
              document.getElementById('messageContainer').classList.remove('hidden');
            } else {
              console.error("GetAccountInfo error:", infoError);
              showError("ล็อกอินสำเร็จ แต่เกิดข้อผิดพลาดในการดึงข้อมูลผู้เล่น");
            }
          });
        } else {
          console.error("Login error:", error);
          // แสดงข้อความผิดพลาดกรณีล็อกอินไม่สำเร็จ
          var errorMsg = error && error.errorMessage ? error.errorMessage : "ไม่สามารถเข้าสู่ระบบได้";
          showError("เกิดข้อผิดพลาดในการล็อกอิน: " + errorMsg);
        }
      });
    });
  </script>
</body>
</html>
